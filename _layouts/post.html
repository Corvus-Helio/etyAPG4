{%- if page.parent -%}
	{%- assign page_number = page.slug | plus: 0 -%}
	{%- for post in site.posts -%}
  	{%- if post.col_name == page.parent -%}
  		{%- assign parent_post = post -%}
		{%- endif -%}
	{%- endfor -%}
	{%- assign collection_name = page.parent -%}
	{%- assign page_category = parent_post.category -%}
{%- elsif page.col_name -%}
	{%- assign page_number = 1 -%}
	{%- assign parent_post = page -%}
	{%- assign collection_name = page.slug -%}
	{%- assign page_category = page.category -%}
{%- else  -%}
	{%- assign parent_post = page -%}
	{%- assign page_category = page.category -%}
{%- endif -%}

{%- if parent_post.cover -%}
	{%- assign pic = parent_post.cover -%}
{%- else -%}
	{%- assign img_array = page.content | split: "<img" -%}
	{%- assign img_array = img_array[1] -%}
	{%- assign img_array = img_array | split: 'src="' -%}
	{%- assign img_array = img_array[1] -%}
	{%- assign img_array = img_array | strip_html -%}
	{%- assign img_array = img_array | split: '"' -%}
	{%- assign pic = img_array[0] -%}
{%- endif -%}

<!DOCTYPE html>

{%- if page.landing == 'home' -%}
<html lang="{{ page.lang | default: site.lang | default: "cn" }}" class ='{{ page.landing }}'>
{%- else -%}
<html lang="{{ page.lang | default: site.lang | default: "cn" }}">
{%- endif -%}

<head>
    <meta charset="utf-8">
    <title>
    {%- if page.parent -%}
    	{%- for post in site.posts -%}
      	{%- if post.col_name == page.parent -%}
      		{%- assign parent_post = post -%}
    		{%- endif %}
    	{%- endfor -%}
      {%- if parent_post.title %}{{ parent_post.title | escape }}{%- else -%}{{ site.title | escape }}{%- endif -%}
    {%- elsif page.cat -%}
      {{ page.cat | escape }}
    {%- else -%}
      {%- if page.title -%}{{ page.title | escape }}{%- else -%}{{ site.title | escape }}{%- endif -%}
    {%- endif -%}
    </title>
		{%- include share.html -%}
    <link rel="apple-touch-icon" sizes="180x180" href="{{ site.baseurl }}/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ site.baseurl }}/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ site.baseurl }}/favicon-16x16.png">
    <link rel="manifest" href="{{ site.baseurl }}/site.webmanifest">
    <link rel="mask-icon" href="{{ site.baseurl }}/safari-pinned-tab.svg" color="#5bbad5">
		{%- include head.html -%}
		<div style="display: none">
				<img style='width: 300px; height: 300px;' src="{{ pic }}" />
		</div>
</head>

{%- if content contains '</h1>' -%}
	{%- assign toc_setting = true -%}
{%- endif -%}
{%- if content contains '$$' or page.math == 1 -%}
	{%- assign math_setting = true -%}
{%- endif -%}
{%- if content contains '<img' -%}
	{%- assign img_setting = true -%}
{%- endif -%}

{%- assign start = page_number | minus: 2 -%}
{%- assign end = page_number | plus: 2 -%}

{%- assign collection = site.multipage | where: 'parent', collection_name -%}
{%- assign total_number_pages = collection.size  | plus: 1 -%}

{%- if start < 1 -%}
  {%- assign start = 1 -%}
  {%- assign end = start | plus: 4 -%}
{%- elsif end > total_number_pages -%}
  {%- assign start = total_number_pages | minus: 4 -%}
  {%- assign end = total_number_pages -%}
{%- endif -%}

{%- if start < 1 -%}
  {%- assign start = 1 -%}
{%- endif -%}
{%- if end > total_number_pages -%}
  {%- assign end = total_number_pages -%}
{%- endif -%}


{% include header.html %}

<main class="page-content" aria-label="Content">
<div class="wrapper">
	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<header class="small-bottom-margin post-header">
			<a class='page-heading-nav' href="{{ site.baseurl }}/hippocampus">海马体</a><span class='page-heading-nav'> /</span>
			<div class="post-title" itemprop="name headline">
	     {%- if parent_post.series_prefix -%}
					{%- assign full_title = parent_post.series_prefix | append: ' · ' | append:  parent_post.title | escape -%}
			 {%- else -%}
				 {%- assign full_title = parent_post.title | escape -%}
			 {%- endif -%}
				{{ full_title }}
			</div>

			<div class="medium-top-margin large-bottom-margin page-meta">
				{% if page_category %}
					{% for folder in site.folders %}
						{% if folder.cat == page_category %}
						{% assign fold = folder %}
						{% endif %}
					{% endfor %}
					<a class='folder-link' href="{{ site.baseurl }}{{ fold.url }}">{{ fold.cat }}</a>
				{% endif %}
				&nbsp; &nbsp;
				{%- if parent_post.modified -%}
				<span class='date-button' id='toggle_date' onclick='change_date()'>首发</span>：
				<time datetime="{{ parent_post.date | date_to_xmlschema }}" itemprop="datePublished">
					<span id='time' class='serif'>{{ parent_post.date | date: "%Y/%m/%d" }}</span>
				</time>
				<script>
					function change_date() {
			  var x = document.getElementById("toggle_date");
				var y = document.getElementById("time");
			  if (x.innerHTML === "首发") {
			    x.innerHTML = "修改";
					y.innerHTML = '{{ parent_post.modified | date: "%Y/%m/%d" }}'
			  } else {
			    x.innerHTML = "首发";
					y.innerHTML = '{{ parent_post.date | date: "%Y/%m/%d" }}'
			  }
			}
				</script>
				{%- else -%}
				<span>首发</span>：
				<time datetime="{{ parent_post.date | date_to_xmlschema }}" itemprop="datePublished">
					<span class='serif'>{{ parent_post.date | date: "%Y/%m/%d" }}</span>
				</time>
			{%- endif -%}
			</div>
			</header>
	<body>

		{%- if toc_setting -%}
		{%- include toc_logic.html html=content -%}
		{%- endif -%}


		{%- if page.parent or page.col_name -%}
		<div class="large-bottom-margin page-block-collection">
		{%- include post_pagination_logic.html -%}
		</div>
		{%- endif -%}


	<div class="post-text" itemprop="articleBody">
	 	{%- assign cont = content -%}
		{%- if toc_setting -%}
			{%- include anchor_injection.html html=cont -%}
		{%- endif -%}
		{%- if math_setting -%}
			{%- include theorem_injection.html html=cont -%}
		{%- endif -%}
		{{ cont }}
	</div>

	{%- if page.parent or page.col_name -%}
	<div class="very-large-top-margin large-bottom-margin page-block-collection">
	{%- include post_pagination_logic.html -%}
	</div>
	{%- endif -%}


	{%- if page.parent or page.col_name -%}
	<div class = 'large-top-margin nav-box'>
	{%- else -%}
	<div class = 'very-large-top-margin nav-box'>
	{%- endif -%}

	{%- if parent_post.previous.url -%}
	<a class="prev small-font page-block" href="{{ site.baseurl }}/{{page.previous.url}}">
	前：<span class='serif'>{{parent_post.previous.title}}</span>
	</a>
	{%- endif -%}

	{%- if parent_post.next.url -%}
	<a class="next small-font page-block" href="{{ site.baseurl }}/{{page.next.url}}">
	后：<span class='serif'>{{parent_post.next.title}}</span>
	</a>
	{%- endif -%}

	</div>

	{%- if toc_setting -%}
		{%- include toc_toggle.html -%}
	{%- endif -%}

	{%- if math_setting -%}
	 	{%- include math.html -%}
	{%- endif -%}

	{% if img_setting %}
		{%- include lazyload.html -%}
	{%- endif -%}

	    {%- if site.disqus.shortname -%} {%- include disqus_comments.html -%} {%- endif -%}
	</body>


		</article>
</div>
</main>

 {% include footer.html %}
